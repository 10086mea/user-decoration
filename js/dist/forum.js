/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={946:t=>{var e=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};e.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},e.prototype.update=function(t){this.context.putImageData(t,0,0)},e.prototype.getPixelCount=function(){return this.width*this.height},e.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},e.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var r=function(){};if(r.prototype.getColor=function(t,e){return this.getPalette(t,5,e)[0]},r.prototype.getPalette=function(t,r,n){void 0===r&&(r=10),(void 0===n||1>n)&&(n=10);for(var a,i,s,c,u=new e(t),l=u.getImageData().data,d=u.getPixelCount(),p=[],f=0;d>f;f+=n)i=l[0+(a=4*f)],s=l[a+1],c=l[a+2],l[a+3]>=125&&(i>250&&s>250&&c>250||p.push([i,s,c]));var h=o.quantize(p,r),m=h?h.palette():null;return u.removeCanvas(),m},!n)var n={map:function(t,e){var r={};return e?t.map((function(t,n){return r.index=n,e.call(r,t)})):t.slice()},naturalOrder:function(t,e){return e>t?-1:t>e?1:0},sum:function(t,e){var r={};return t.reduce(e?function(t,n,o){return r.index=o,t+e.call(r,n)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?n.map(t,e):t)}};var o=function(){function t(t,e,r){return(t<<2*c)+(e<<c)+r}function e(t){function e(){r.sort(t),n=!0}var r=[],n=!1;return{push:function(t){r.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||e(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||e(),r}}}function r(t,e,r,n,o,a,i){var s=this;s.r1=t,s.r2=e,s.g1=r,s.g2=n,s.b1=o,s.b2=a,s.histo=i}function o(){this.vboxes=new e((function(t,e){return n.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())}))}function a(e){var r,n,o,a,i=new Array(1<<3*c);return e.forEach((function(e){n=e[0]>>u,o=e[1]>>u,a=e[2]>>u,r=t(n,o,a),i[r]=(i[r]||0)+1})),i}function i(t,e){var n,o,a,i=1e6,s=0,c=1e6,l=0,d=1e6,p=0;return t.forEach((function(t){n=t[0]>>u,o=t[1]>>u,a=t[2]>>u,i>n?i=n:n>s&&(s=n),c>o?c=o:o>l&&(l=o),d>a?d=a:a>p&&(p=a)})),new r(i,s,c,l,d,p,e)}function s(e,r){if(r.count()){var o=r.r2-r.r1+1,a=r.g2-r.g1+1,i=r.b2-r.b1+1,s=n.max([o,a,i]);if(1==r.count())return[r.copy()];var c,u,l,d,p=0,f=[],h=[];if(s==o)for(c=r.r1;c<=r.r2;c++){for(d=0,u=r.g1;u<=r.g2;u++)for(l=r.b1;l<=r.b2;l++)d+=e[t(c,u,l)]||0;p+=d,f[c]=p}else if(s==a)for(c=r.g1;c<=r.g2;c++){for(d=0,u=r.r1;u<=r.r2;u++)for(l=r.b1;l<=r.b2;l++)d+=e[t(u,c,l)]||0;p+=d,f[c]=p}else for(c=r.b1;c<=r.b2;c++){for(d=0,u=r.r1;u<=r.r2;u++)for(l=r.g1;l<=r.g2;l++)d+=e[t(u,l,c)]||0;p+=d,f[c]=p}return f.forEach((function(t,e){h[e]=p-t})),function(t){var e,n,o,a,i,s=t+"1",u=t+"2",l=0;for(c=r[s];c<=r[u];c++)if(f[c]>p/2){for(o=r.copy(),a=r.copy(),e=c-r[s],i=(n=r[u]-c)>=e?Math.min(r[u]-1,~~(c+n/2)):Math.max(r[s],~~(c-1-e/2));!f[i];)i++;for(l=h[i];!l&&f[i-1];)l=h[--i];return o[u]=i,a[s]=o[u]+1,[o,a]}}(s==o?"r":s==a?"g":"b")}}var c=5,u=8-c;return r.prototype={volume:function(t){var e=this;return(!e._volume||t)&&(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var r=this,n=r.histo;if(!r._count_set||e){var o,a,i,s=0;for(o=r.r1;o<=r.r2;o++)for(a=r.g1;a<=r.g2;a++)for(i=r.b1;i<=r.b2;i++)index=t(o,a,i),s+=n[index]||0;r._count=s,r._count_set=!0}return r._count},copy:function(){var t=this;return new r(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var r=this,n=r.histo;if(!r._avg||e){var o,a,i,s,u=0,l=1<<8-c,d=0,p=0,f=0;for(a=r.r1;a<=r.r2;a++)for(i=r.g1;i<=r.g2;i++)for(s=r.b1;s<=r.b2;s++)u+=o=n[t(a,i,s)]||0,d+=o*(a+.5)*l,p+=o*(i+.5)*l,f+=o*(s+.5)*l;r._avg=u?[~~(d/u),~~(p/u),~~(f/u)]:[~~(l*(r.r1+r.r2+1)/2),~~(l*(r.g1+r.g2+1)/2),~~(l*(r.b1+r.b2+1)/2)]}return r._avg},contains:function(t){var e=this,r=t[0]>>u;return gval=t[1]>>u,bval=t[2]>>u,r>=e.r1&&r<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},o.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map((function(t){return t.color}))},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,r=0;r<e.size();r++)if(e.peek(r).vbox.contains(t))return e.peek(r).color;return this.nearest(t)},nearest:function(t){for(var e,r,n,o=this.vboxes,a=0;a<o.size();a++)(e>(r=Math.sqrt(Math.pow(t[0]-o.peek(a).color[0],2)+Math.pow(t[1]-o.peek(a).color[1],2)+Math.pow(t[2]-o.peek(a).color[2],2)))||void 0===e)&&(e=r,n=o.peek(a).color);return n},forcebw:function(){var t=this.vboxes;t.sort((function(t,e){return n.naturalOrder(n.sum(t.color),n.sum(e.color))}));var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var r=t.length-1,o=t[r].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[r].color=[255,255,255])}},{quantize:function(t,r){function c(t,e){for(var r,n=1,o=0;1e3>o;)if((r=t.pop()).count()){var a=s(u,r),i=a[0],c=a[1];if(!i)return;if(t.push(i),c&&(t.push(c),n++),n>=e)return;if(o++>1e3)return}else t.push(r),o++}if(!t.length||2>r||r>256)return!1;var u=a(t);u.forEach((function(){}));var l=i(t,u),d=new e((function(t,e){return n.naturalOrder(t.count(),e.count())}));d.push(l),c(d,.75*r);for(var p=new e((function(t,e){return n.naturalOrder(t.count()*t.volume(),e.count()*e.volume())}));d.size();)p.push(d.pop());c(p,r-p.size());for(var f=new o;p.size();)f.push(p.pop());return f}}}();t.exports=r},24:(t,e,r)=>{var n=r(735).default;function o(){"use strict";t.exports=o=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var e,r={},a=Object.prototype,i=a.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function p(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{p({},"")}catch(e){p=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o=e&&e.prototype instanceof x?e:x,a=Object.create(o.prototype),i=new A(n||[]);return s(a,"_invoke",{value:D(t,r,i)}),a}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=f;var m="suspendedStart",v="suspendedYield",y="executing",g="completed",b={};function x(){}function w(){}function _(){}var I={};p(I,u,(function(){return this}));var N=Object.getPrototypeOf,k=N&&N(N(B([])));k&&k!==a&&i.call(k,u)&&(I=k);var E=_.prototype=x.prototype=Object.create(I);function j(t){["next","throw","return"].forEach((function(e){p(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function r(o,a,s,c){var u=h(t[o],t,a);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==n(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(d).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var o;s(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}})}function D(t,r,n){var o=m;return function(a,i){if(o===y)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=P(s,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===m)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=h(t,r,n);if("normal"===u.type){if(o=n.done?g:v,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function P(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,P(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var a=h(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,b;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function B(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=_,s(E,"constructor",{value:_,configurable:!0}),s(_,"constructor",{value:w,configurable:!0}),w.displayName=p(_,d,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,_):(t.__proto__=_,p(t,d,"GeneratorFunction")),t.prototype=Object.create(E),t},r.awrap=function(t){return{__await:t}},j(C.prototype),p(C.prototype,l,(function(){return this})),r.AsyncIterator=C,r.async=function(t,e,n,o,a){void 0===a&&(a=Promise);var i=new C(f(t,e,n,o),a);return r.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},j(E),p(E,d,"Generator"),p(E,u,(function(){return this})),p(E,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=B,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:B(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},r}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";function t(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function e(e){return function(){var r=this,n=arguments;return new Promise((function(o,a){var i=e.apply(r,n);function s(e){t(i,o,a,s,c,"next",e)}function c(e){t(i,o,a,s,c,"throw",e)}s(void 0)}))}}r.r(n),r.d(n,{DecorationWarpComponent:()=>x,StyleFetcher:()=>s,applyDecoration:()=>c,applyDecorationOn:()=>y,extend:()=>$t,makeWarpComponent:()=>b,reloadStyleElement:()=>g});var o=r(183),a=r.n(o),i=null,s=function(){function t(t){this.fetchIntervalId=-1,this.fetchId={},this.cb=[],this.app=void 0,i=this,this.app=t}var r=t.prototype;return r.done=function(t){this.cb.push(t)},t.getInstance=function(){return i},r.sendFetch=function(){var t=e(a().mark((function t(){var e,r,n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.fetchIntervalId=-1,e=this.fetchId,r=Object.keys(e).map((function(t){return parseInt(t)})),this.fetchId={},t.next=6,this.app.store.find("user_decoration",{id:r});case 6:t.sent,r.forEach((function(t){e[t].forEach((function(e){e(n.app.store.getById("user-decorations",t+""))}))})),this.cb.forEach((function(t){t()}));case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),r.fetchStyle=function(t){var e=this;if(!t)return Promise.resolve(null);t=parseInt(t+"");var r=this.app.store.getById("user-decorations",t+"");return r?Promise.resolve(r):new Promise((function(r){e.fetchId[t]=e.fetchId[t]||[],e.fetchId[t].push(r),-1==e.fetchIntervalId&&(e.fetchIntervalId=setTimeout(e.sendFetch.bind(e),400))}))},r.fetchStyleSync=function(t){return this.app.store.getById("user-decorations",t+"")||void 0},r.getApp=function(){return this.app},t}();function c(t,e){var r,n;if(!t.decoration&&(t.decorationId&&(t.decoration=null==(r=s.getInstance())?void 0:r.fetchStyleSync(t.decorationId),t.decoration||null==(n=s.getInstance())||n.fetchStyle(t.decorationId).then((function(){$(e.element).addClass("user-decoration-hijack-wait-reload"),m.redraw()}))),!t.decoration))return;t.container&&y(t.container,t.decoration)}var u={},l={},d={};function p(t,e,r,n){d[t]||(d[t]={}),d[t][e]||(d[t][e]=!0,console.warn(r,n))}function f(t,e){var r,n;if(e instanceof RegExp){var o;if(e.test((null==(o=t.attrs)?void 0:o.className)||""))return!0}else{if("*"==e)return!0;if(((null==(r=t.attrs)?void 0:r.className)||"").includes(e))return!0;if(((null==(n=t.tag)?void 0:n.toString())||"").includes(e))return!0}return!1}function h(t,e,r,n){if(void 0===n&&(n=[]),"#"!=t.tag){var o=r;if(f(t,e[r])&&++o==e.length)return t;if("object"==typeof t.children&&"number"==typeof t.children.length)for(var a=0;a<t.children.length;a++)if(t.children[a]){var i,s=h(t.children[a],e,o,n);if(s)return null==(i=n)||i.unshift(a),s}return null}}function v(t,e,r,n){var o=null;if(l[e][r]&&(o=function(t,e,r){for(var n,o=t;void 0!==(n=e.shift());){if(!o.children||"object"!=typeof o.children||!o.children[n])return null;o=o.children[n]}return f(o,r)?o:null}(t,l[e][r],n),o||(l[e][r]=!1)),!o){var a=[];!1===l[e][r]?o=h(t,n,0,void 0):(o=h(t,n,0,a))&&(l[e][r]=a)}return o}function y(t,e){var r=e.id();if(!u[r]){var n=e.style();u[r]={};for(var o=n.matchAll(/\.(element-[^\[\{]*)((?:\[[a-zA-Z0-9]+=.+\])*)[^\[]/gi),a=o.next();!a.done;){var i=a.value,s=i[1],c=i[2],d={};if(c)for(var h=c.matchAll(/\[([a-zA-Z0-9]+)=([^\]]+)\]/gi),m=h.next();!m.done;){var y=m.value,g=y[1],b=y[2].trim();if(b.startsWith('"')&&b.endsWith('"')||b.startsWith("'")&&b.endsWith("'"))d[g]=b.slice(1,-1);else if(b.startsWith("/")&&b.includes("/",1)){var x=b.split("/");d[g]=new RegExp(x[1],x[2])}else d[g]=b;m=h.next()}d.tag&&"#"!=d.tag||(d.tag="span"),d.copy&&("string"==typeof d.copy?d.copy=d.copy.split(" "):d.copy=[d.copy]),d.parent&&("string"==typeof d.parent?d.parent=d.parent.split(" "):d.parent=[d.parent]),u[r][s]=d,a=o.next()}n=(n=n.replace(/(\.element-[^\[]*)(?:\[[a-zA-Z0-9]*=.*\])*([^\[])/gi,"$1$2")).replace(/\.base/g,".user-decoration-"+r);var w=$("<style>").attr("id","user-decoration-"+r);w.html(n),$("head").append(w)}l[r]||(l[r]={});var _=[];Object.keys(u[r]).forEach((function(e){var n,o=u[r][e],a=null;if(o.parent){if(!(a=v(t,r,e,o.parent)))return void p(r,e,"[DecorationApplier] Parent element is not found.",{createSpec:o,element:t})}else a=t;if(a.children&&"object"==typeof a.children&&"number"==typeof(null==(n=a.children)?void 0:n.length)){var i=null;if(o.copy){var s=v(t,r,e,o.copy);if(s&&(i=$.extend(!0,{},s)),!i)return void p(r,e,"[DecorationApplier] To copy element not found",{createSpec:o,element:t});o.class&&(i.attrs.className=(i.attrs.className||"")+" "+o.class),i.attrs.className=(i.attrs.className||"")+" "+e}else i={tag:o.tag,states:void 0,attrs:{className:(o.class||"")+" "+e,style:o.style||""},children:[{tag:"#",children:o.content||"",attrs:{},states:void 0}]};var c=t.children.length-1;if(o.after&&t.children)for(var l=0;l<t.children.length;l++)if(f(t.children[l],o.after)){c=l;break}_.push([a,c,i])}else p(r,e,"[DecorationApplier] Parent element is not a fragment.",{createSpec:o,parent:a,element:t})})),_.forEach((function(t){t[0].children.splice(t[1]+1,0,t[2])})),new RegExp("( |^)user-decoration-"+r+"( |$)").test(t.attrs.className)||(t.attrs.className+=" user-decoration-"+r),/( |^)has-user-decoration( |$)/.test(t.attrs.className)||(t.attrs.className+=" has-user-decoration")}function g(t){u[t]&&($("#user-decoration-"+t).remove(),delete u[t],m.redraw())}function b(t,e,r,n){return new Proxy(new x(t,e,r,n),{get:function(t,e){return t.hasOwnProperty(e)||"toString"==e?t[e]:"function"==typeof t.stringRet[e]?t.stringRet[e].bind(t.stringRet):t.stringRet[e]}})}var x=function(){function t(t,e,r,n){this.states=void 0,this.attrs=void 0,this.element=void 0,this.tag=void 0,this.children=void 0,this.stringRet=void 0,this.data=void 0,this.stringRet=e,this.states=t.states,this.attrs=t.attrs,this.element=t.element,this.tag=t.tag,this.children=[{tag:"span",attrs:{class:n},states:void 0,children:[{tag:"#",children:e,attrs:{},states:void 0}]}],t.children&&(this.children=t.children),this.data=r}return t.prototype.toString=function(){return this.stringRet},t}();const w=flarum.core.compat["forum/app"];var _=r.n(w);const I=flarum.core.compat["common/Component"];var N=r.n(I);const k=flarum.core.compat["common/extend"],E=flarum.core.compat["common/models/User"];var j=r.n(E);const C=flarum.core.compat["common/utils/computed"];var D=r.n(C);const P=flarum.core.compat["common/utils/stringToColor"];var S=r.n(P),O=r(946),A=r.n(O);const B=flarum.core.compat["forum/components/Post"];var L=r.n(B);const U=flarum.core.compat["forum/components/UserCard"];var F=r.n(U);const T=flarum.core.compat["forum/components/UsersSearchSource"];var M=r.n(T);const R=flarum.core.compat["common/helpers/username"];var z=r.n(R);const H=flarum.core.compat["common/helpers/highlight"];var q=r.n(H),G=0,W=null;function V(){var t;return null==(t=s.getInstance())||null==(t=t.getApp().forum)?void 0:t.attribute("username_hijack")}function Z(){var t;return null==(t=s.getInstance())||null==(t=t.getApp().forum)?void 0:t.attribute("avatar_hijack")}var J=0;function Y(){J=0,$(".decoration-container").each((function(t,e){var r=$(e);r.length&&!["absolute","fixed","relative"].includes(window.getComputedStyle(r[0]).position)&&r.css("position","relative"),!r.length||r.hasClass("Post")||r.hasClass("UserCard")||"auto"!==window.getComputedStyle(r[0]).zIndex||r.css("z-index","0"),r.hasClass("before-positioning")&&r.removeClass("before-positioning")}))}function K(){var t=j().prototype.avatarUrl;j().prototype.realAvatarUrl=t,j().prototype.hijackColor=function(){var t=this;return D()("displayName","realAvatarUrl","avatarColor",(function(e,r,n){return n?"rgb("+n.join(", ")+")":r?(function(t,e){var r=new Image;r.addEventListener("load",(function(){try{var e=new(A());t.avatarColor=e.getColor(this)}catch(e){if(!(e instanceof TypeError))throw e;t.avatarColor=[255,255,255]}t.freshness=new Date,m.redraw()})),r.crossOrigin="anonymous",r.src=null!=e?e:""}(t,r),""):"#"+S()(e)})).call(this)},j().prototype.color=j().prototype.hijackColor,(0,k.override)(j().prototype,"avatarUrl",(function(){var e;if(!Z())return t.call(this);var r=this.hijackColor();r&&r.charAt&&(r=r.replace(/#/g,"@"));var n=JSON.stringify({decorationId:null==(e=this.data.attributes)?void 0:e.avatar_decoration,username:this.username(),displayName:this.realDisplayName(),id:this.id(),color:r});return(t.call(this)||"").split("#").pop()+"#"+n}));var r=j().prototype.username;j().prototype.realUserName=r,j().prototype.realDisplayName=j().prototype.displayName,(0,k.override)(j().prototype,"displayName",(function(t){return V()?b({tag:"span",attrs:{className:"username-container decoration-container before-positioning",user:this}},t(),{user:this},"username-text"):t()})),(0,k.extend)(N().prototype,["oninit"],(function(){(V()||Z())&&(this.userDecorationHijackIid=G++,this.originalView=this.view.bind(this),this.view=X.bind(this),this.originalOnBefUp=this.onbeforeupdate.bind(this),this.onbeforeupdate=Q.bind(this))})),(0,k.extend)(N().prototype,["onupdate","oncreate"],e(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:J||(J=setTimeout(Y,20));case 1:case"end":return t.stop()}}),t)})))),console.log("Decoration Hijack loaded")}function Q(){var t=0!==this.$(".user-decoration-hijack-wait-reload").length||$(this.element).hasClass("user-decoration-hijack-wait-reload");$(this.element).removeClass("user-decoration-hijack-wait-reload");for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];if(!1===this.originalOnBefUp.apply(this,r)){if(t)return;return!1}}function X(t){var e,r=this.originalView(t);return r?(W||null===W&&(W=(W=((null==(e=s.getInstance())||null==(e=e.getApp().forum)?void 0:e.attribute("no_decorate_class_filter"))||"").split("\n")).map((function(t){return t.trim()})).filter((function(t){return""!==t}))),et(r)?nt(r,this,!1):rt(r)?ot(r,this,!1):(tt(null,r,t,this,!1),r)):r}function tt(t,e,r,n,o){var a,i;e!==r&&(!o&&null!=(a=W)&&a.length&&((null==(i=e.attrs)?void 0:i.className)||"").split(" ").forEach((function(t){W.includes(t)&&(o=!0)})),"object"==typeof e&&e.forEach&&e.forEach((function(t){t&&tt({children:e},t,r,n,o)})),t&&et(e)?t.children=t.children.map((function(t){return t===e?nt(t,n,o):t})):t&&rt(e)?t.children=t.children.map((function(t){return t===e?ot(e,n,o):t})):"object"==typeof e.children&&e.children.forEach&&e.children.forEach((function(t){t&&tt(e,t,r,n,o)})))}function et(t){var e;return t&&"img"==t.tag&&(null==(e=t.attrs.className)?void 0:e.includes("Avatar"))&&/( |^)Avatar( |$)/.test(t.attrs.className)&&t.attrs.src}function rt(t){return t&&t instanceof x&&((t.attrs.className||"")+"").includes("username-container")}function nt(t,e,r){var n,o=t.attrs.src.split("#");if(2!=o.length)return t;var a=t,i=JSON.parse(o.pop()),s=o.shift();if(!s){var u;a.tag="span",a.children=[{tag:"#",children:null==(u=i.username)?void 0:u.charAt(0),state:void 0,attrs:{}}];var l,d=i.color;d&&d.charAt&&(d=d.replace(/@/g,"#")),d&&(a.attrs.style=(null!=(l=a.attrs.style)?l:"")+";--avatar-bg: "+d+";")}if(a.attrs.src=s,r)return a;var p,f={tag:"span",attrs:{"data-ctr":"avatar"},state:void 0,children:[a]};return f.attrs.style=a.attrs.style,f.attrs.className=(null!=(n=a.attrs.className)?n:"")+" Avatar-container decoration-container before-positioning",f.attrs["data-userDecorationHijackIid"]=e.userDecorationHijackIid,e.appendRelative&&(f.attrs.style=(null!=(p=f.attrs.style)?p:"")+";position:relative;"),a.attrs.className="",i.container=f,c(i,e),f}function ot(t,e,r){var n=t.data.user;return r?z()(n):(c({decorationId:n.attribute("name_decoration"),username:n.attribute("username"),container:t},e),t)}const at=flarum.core.compat["forum/components/UserPage"];var it=r.n(at);const st=flarum.core.compat["common/components/LinkButton"];var ct=r.n(st);function ut(t,e){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ut(t,e)}function lt(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,ut(t,e)}const dt=flarum.core.compat["common/components/LoadingIndicator"];var pt=r.n(dt);const ft=flarum.core.compat["common/components/Button"];var ht=r.n(ft);const mt=flarum.core.compat["common/components/Modal"];var vt=r.n(mt);const yt=flarum.core.compat["common/components/Select"];var gt=r.n(yt);const bt=flarum.core.compat["common/utils/setRouteWithForcedRefresh"];var xt=r.n(bt),wt=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).loading=!1,e.decorationId="",e.decoration=null,e}lt(r,t);var n=r.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return this.attrs.decoration_id?_().translator.trans("xypp-user-decoration.forum.create-modal.edit-title",[this.attrs.decoration_id]):_().translator.trans("xypp-user-decoration.forum.create-modal.title")},n.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",{for:"xypp-user-decoration-create-ipt-type"},_().translator.trans("xypp-user-decoration.forum.create-modal.type.title")),m(gt(),{id:"xypp-user-decoration-create-ipt-type",options:{avatar:_().translator.trans("xypp-user-decoration.forum.create-modal.type.avatar"),name:_().translator.trans("xypp-user-decoration.forum.create-modal.type.username"),card:_().translator.trans("xypp-user-decoration.forum.create-modal.type.usercard"),post:_().translator.trans("xypp-user-decoration.forum.create-modal.type.post")}})),m("div",{className:"Form-group"},m("label",{for:"xypp-user-decoration-create-ipt-name"},_().translator.trans("xypp-user-decoration.forum.create-modal.name")),m("input",{id:"xypp-user-decoration-create-ipt-name",required:!0,className:"FormControl",step:"any"})),m("div",{className:"Form-group"},m("label",{for:"xypp-user-decoration-create-ipt-desc"},_().translator.trans("xypp-user-decoration.forum.create-modal.desc")),m("textarea",{id:"xypp-user-decoration-create-ipt-desc",required:!0,className:"FormControl",step:"any"})),m("p",null,_().translator.trans("xypp-user-decoration.forum.create-modal.tip")),m("div",{className:"Form-group"},m("label",{for:"xypp-user-decoration-create-ipt-style"},_().translator.trans("xypp-user-decoration.forum.create-modal.style")),m("textarea",{id:"xypp-user-decoration-create-ipt-style",required:!0,className:"FormControl",step:"any"})),m("div",{className:"Form-group"},m(ht(),{class:"Button Button--primary",type:"submit",loading:this.loading,disabled:this.loading},this.attrs.decoration_id?_().translator.trans("xypp-user-decoration.forum.create-modal.edit-button"):_().translator.trans("xypp-user-decoration.forum.create-modal.button")),this.attrs.decoration_id?m(ct(),{loading:this.loading,disabled:this.loading,onclick:this.delete.bind(this)},m("i",{class:"fas fa-trash"}),_().translator.trans("xypp-user-decoration.forum.create-modal.delete-button")):"")))},n.onready=function(){var t,e=this;this.decorationId=this.attrs.decoration_id,this.decorationId&&(this.loading=!0,null==(t=s.getInstance())||t.fetchStyle(this.decorationId).then((function(t){e.decoration=t,e.loading=!1,e.$("#xypp-user-decoration-create-ipt-name").val(t.name()),e.$("#xypp-user-decoration-create-ipt-desc").val(t.desc()),e.$("#xypp-user-decoration-create-ipt-style").val(t.style()),e.$("#xypp-user-decoration-create-ipt-type").val(t.type()),m.redraw()})))},n.onsubmit=function(){var t=e(a().mark((function t(e){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),this.loading=!0,t.prev=2,t.next=5,_().request({url:_().forum.attribute("apiUrl")+"/user_decoration",method:"POST",body:{attributes:{id:this.decorationId,style:this.$("#xypp-user-decoration-create-ipt-style").val(),desc:this.$("#xypp-user-decoration-create-ipt-desc").val(),name:this.$("#xypp-user-decoration-create-ipt-name").val(),type:this.$("#xypp-user-decoration-create-ipt-type").val()}}});case 5:r=t.sent,_().store.pushPayload(r),g(parseInt(this.decorationId)),_().modal.close(),_().alerts.show({type:"success"},_().translator.trans("xypp-user-decoration.forum.create-success")),xt()(_().route("user.user_own_decoration",{username:_().current.get("user").attribute("slug")})),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),this.loading=!1;case 16:case"end":return t.stop()}}),t,this,[[2,13]])})));return function(e){return t.apply(this,arguments)}}(),n.delete=function(){var t=e(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(confirm(_().translator.trans("xypp-user-decoration.forum.delete_confirm"))){t.next=2;break}return t.abrupt("return");case 2:return this.loading=!0,t.prev=3,t.next=6,_().request({url:_().forum.attribute("apiUrl")+"/user_decoration/"+this.attrs.decoration_id+"/delete",method:"GET"});case 6:_().modal.close(),_().alerts.show({type:"success"},_().translator.trans("xypp-user-decoration.forum.delete-success")),xt()(_().route("user.user_own_decoration",{username:_().current.get("user").attribute("slug")})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),this.loading=!1;case 14:case"end":return t.stop()}}),t,this,[[3,11]])})));return function(){return t.apply(this,arguments)}}(),r}(vt());const _t=flarum.core.compat["common/helpers/avatar"];var It=r.n(_t);function Nt(t,e,r){return t?e:r||""}var kt=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).type="",e.id=0,e.isCurrent=!1,e.uodId=0,e.decoration=null,e.changing=!1,e}lt(r,t);var n=r.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e)},n.oncreate=function(e){t.prototype.oncreate.call(this,e)},n.onupdate=function(e){t.prototype.onupdate.call(this,e)},n.change=function(){var t=e(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.changing=!0,m.redraw(),e={},this.isCurrent?e[this.type+"_decoration"]="null":e[this.type+"_decoration"]=this.decoration.id(),t.next=6,_().session.user.save(e);case 6:this.changing=!1,m.redraw();case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.view=function(){var t,e,r;this.id=this.attrs.decoration_id,this.type=this.attrs.type,this.uodId=this.attrs.user_own_decoration_id,["avatar","name","card","post"].includes(this.type)||(this.type="error");var n,o,a=m("div",{class:"error"},_().translator.trans("xypp-user-decoration.forum.decoration-box.error")),i={id:parseInt(_().session.user.id()||""),username:_().session.user.username(),decorationId:this.id,color:_().session.user.hijackColor().replace(/\#/g,"@")};if(this.decoration=_().store.getById("user-decorations",i.decorationId+""),this.decoration||null==(n=s.getInstance())||n.fetchStyle(this.id).then((function(){return m.redraw()})),this.changing)a=m(pt(),null);else if("avatar"==this.type){var c;a=_().forum.attribute("username_hijack")?m("img",{title:"-",class:"Avatar",src:((null==(c=_().session.user)?void 0:c.realAvatarUrl())||"")+"#"+JSON.stringify(i)}):_().translator.trans("xypp-user-decoration.forum.decoration-box.closed")}else if("name"==this.type){var u;_().forum.attribute("username_hijack")?(a=m("span",{class:"username-container username"},m("span",{class:"username-text"},null==(u=_().session.user)?void 0:u.realUserName())),this.decoration&&y(a,this.decoration)):a=_().translator.trans("xypp-user-decoration.forum.decoration-box.closed")}else if("card"==this.type){var l;a=m("div",{class:"decoration-box-card-container"},m(F(),{user:_().session.user,controlsButtonClassName:"UserCard-controls App-primaryControl",className:"UserCard--popover in",decoration_id:null==(l=this.decoration)?void 0:l.id()}))}else if("post"==this.type){var d=(o=_().session.user,m("div",{class:"PostStream-item","data-index":"0","data-time":"2024-06-27T15:05:51.000Z","data-number":"1","data-id":"1","data-type":"comment"},m("article",{class:"CommentPost Post Post--by-actor Post--by-start-user"},m("div",null,m("header",{class:"Post-header"},m("ul",null,m("li",{class:"item-user"},m("div",{class:"PostUser"},m("h3",{class:"PostUser-name"},m("a",null,It()(o),m("span",{class:"UserOnline"}),z()(o))))))),m("aside",{class:"Post-actions"},m("ul",null,m("li",null,m("div",{class:"ButtonGroup Dropdown dropdown Post-controls itemCount3"},m("button",{class:"Dropdown-toggle Button Button--icon Button--flat","aria-haspopup":"menu","aria-label":"Toggle post controls dropdown menu","data-toggle":"dropdown"},m("i",{"aria-hidden":"true",class:"icon fas fa-ellipsis-h Button-icon"}))))))))));this.decoration&&y(d,this.decoration),a=m("div",{class:"decoration-box-card-container"},d)}return this.isCurrent=this.decoration&&(null==(t=_().session.user)?void 0:t.attribute(this.type+"_decoration"))==(null==(e=this.decoration)?void 0:e.id()),m("div",{className:"DecorationBox"},m("div",{className:"decoration-head"},m("div",{className:"decoration-name"},null==(r=this.decoration)?void 0:r.name()),m("div",{className:"decoration-type"},_().translator.trans("xypp-user-decoration.forum.decoration-box."+this.type))),m("div",{className:"prev-warpper"},a),m("div",{class:"decoration-box-content"},this.decoration?this.decoration.desc():_().translator.trans("xypp-user-decoration.forum.decoration-box.loading")),Nt(!this.attrs.noBtn,m(ht(),{class:"Button Button--primary",loading:this.changing,disabled:this.changing,onclick:this.change.bind(this)},this.isCurrent?_().translator.trans("xypp-user-decoration.forum.decoration.remove_button"):_().translator.trans("xypp-user-decoration.forum.decoration.change_button"))),Nt(!(this.attrs.noDelete||!this.uodId),m("div",{class:"delete-decoration",onclick:this.delete.bind(this)},m("i",{class:"fas fa-times","aria-label":_().translator.trans("xypp-user-decoration.forum.decoration.delete_button")}))),Nt(!this.attrs.noEdit,m("div",{class:"edit-decoration",onclick:this.edit.bind(this)},m("i",{class:"fas fa-edit","aria-label":_().translator.trans("xypp-user-decoration.forum.decoration.edit_button")}))))},n.delete=function(){var t=e(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!confirm(_().translator.trans("xypp-user-decoration.forum.decoration.delete_confirm"))){t.next=6;break}return this.changing=!0,t.next=4,_().request({url:_().forum.attribute("apiUrl")+"/user-own-decoration/"+this.uodId+"/delete"});case 4:this.changing=!1,xt()(_().route("user.user_own_decoration",{username:_().current.get("user").attribute("slug")}));case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.edit=function(){_().modal.show(wt,{decoration_id:this.decoration.id()})},r}(N());const Et=flarum.core.compat["common/components/Placeholder"];var jt=r.n(Et),Ct=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).loading=!1,e.record=null,e}lt(r,t);var n=r.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},n.oncreate=function(t){},n.onupdate=function(t){},n.show=function(e){t.prototype.show.call(this,e),this.loadData()},n.content=function(){var t,e,r=this;return m("div",{className:"decoration-page-container"},m("div",{class:"decoration-page-title"},m("h3",null,_().translator.trans("xypp-user-decoration.forum.decorations")),_().session.user.canCreateDecoration()?m(ht(),{class:"Button Button--primary",onclick:this.create.bind(this)},m("i",{class:"fas fa-plus"}),m("span",null,_().translator.trans("xypp-user-decoration.forum.create"))):""),m("div",{className:"decoration-page"},Nt(this.loading,m(pt(),{display:"block"}),Nt(!(null==(t=this.record)||!t.length),null==(e=this.record)?void 0:e.map((function(t,e){var n,o,a;return m(kt,{type:t.decoration_type(),user_own_decoration_id:!t.attribute("fake")&&t.id(),decoration_id:t.decoration_id(),noBtn:(null==(n=r.user)?void 0:n.id())!=(null==(o=_().session.user)?void 0:o.id()),noDelete:!(null!=(a=_().session.user)&&a.canDeleteDecoration()),noEdit:!_().session.user.canCreateDecoration()})})),m(jt(),{text:_().translator.trans("xypp-user-decoration.forum.decoration-no-available")})))))},n.loadData=function(){var t=e(a().mark((function t(){var e,r,n,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.record){t.next=2;break}return t.abrupt("return");case 2:if(null!=(e=this.user)&&e.id()){t.next=4;break}return t.abrupt("return");case 4:if(!this.loading){t.next=6;break}return t.abrupt("return");case 6:return this.loading=!0,_().store.all("user-own-decoration").forEach((function(t){_().store.remove(t)})),m.redraw(),t.next=11,_().request({url:_().forum.attribute("apiUrl")+"/user-own-decoration?id="+(null==(r=this.user)?void 0:r.id()),method:"GET"});case 11:n=t.sent,o=1,n.data.forEach((function(t){return o=Math.max(o,t.id||0)})),n.data.forEach((function(t){t.attributes.fake=!t.id,t.id=t.id||++o})),this.record=_().store.pushPayload(n),this.loading=!1,m.redraw();case 18:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),n.create=function(){_().modal.show(wt)},r}(it()),Dt=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).loading=!0,e.records={},e.value=0,e.decorationBox=null,e.decorationType="",e.decorationId="",e}lt(r,t);var n=r.prototype;return n.className=function(){return"Modal--small"},n.title=function(){return _().translator.trans("xypp-user-decoration.forum.modal.title")},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("p",null,_().translator.trans("xypp-user-decoration.forum.modal.tip")),m(gt(),{options:this.records,value:this.value,onchange:this.change.bind(this)}),m(kt,{noBtn:!0,oncreate:function(e){return t.decorationBox=e},decoration_id:t.decorationId,type:t.decorationType}),m("div",{className:"paymodal-btn"},m(ht(),{class:"Button Button--primary",loading:this.loading,disabled:this.loading,onclick:this.offer.bind(this)},_().translator.trans("xypp-user-decoration.forum.modal.button"))))},n.onready=function(){var t=this;this.loading=!0,_().store.find("user_decoration_all").then((function(){t.records={},_().store.all("user-decorations").forEach((function(e){t.records[parseInt(e.id())]="["+_().translator.trans("xypp-user-decoration.forum.decoration-box."+e.attribute("type"))+"]"+e.attribute("name")+":"+e.attribute("desc")})),t.loading=!1,m.redraw()}))},n.offer=function(){var t=e(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,_().request({url:_().forum.attribute("apiUrl")+"/user-own-decoration",method:"POST",body:{attributes:{user_id:this.attrs.user_id,decoration_id:this.decorationId}}});case 4:_().modal.close(),xt()(_().route("user.user_own_decoration",{username:_().current.get("user").attribute("slug")})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),this.loading=!1;case 11:case"end":return t.stop()}}),t,this,[[1,8]])})));return function(){return t.apply(this,arguments)}}(),n.change=function(t){this.value=t;var e=_().store.getById("user-decorations",t);this.decorationType=e.type(),this.decorationId=e.id(),m.redraw()},r}(vt());const Pt=flarum.core.compat["forum/utils/UserControls"];var St=r.n(Pt);const Ot=flarum.core.compat["common/Model"];var At=r.n(Ot);const Bt=flarum.extensions["xypp-store"]&&{addFrontendProviders:flarum.extensions["xypp-store"].addFrontendProviders,PurchaseHelper:flarum.extensions["xypp-store"].PurchaseHelper,UseHelper:flarum.extensions["xypp-store"].UseHelper};_().initializers.add("xypp/user-decoration",(function(){var t,r;j().prototype.canOfferDecoration=At().attribute("canOfferDecoration"),j().prototype.canViewDecoration=At().attribute("canViewDecoration"),j().prototype.canCreateDecoration=At().attribute("canCreateDecoration"),j().prototype.canDeleteDecoration=At().attribute("canDeleteDecoration"),new s(_()),K(),(0,k.override)(L().prototype,"view",(function(t){var e;this.userDecorationHijackIid=this.userDecorationHijackIid||G++;for(var r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];var a=t(n),i=null==(e=this.attrs.post)?void 0:e.user();if(!i)return a;a.attrs["data-userDecorationHijackIid"]=this.userDecorationHijackIid,a.attrs.className=(a.attrs.className||"")+" decoration-container before-positioning";var s={username:i.realUserName(),container:a,id:i.id(),decorationId:i.attribute("post_decoration")};return this.attrs.decoration_id&&(s.decorationId=this.attrs.decoration_id),c(s,this),a})),(0,k.override)(F().prototype,"view",(function(t){this.userDecorationHijackIid=this.userDecorationHijackIid||G++;for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var o=t(r);o.attrs["data-userDecorationHijackIid"]=this.userDecorationHijackIid,o.attrs.className=(o.attrs.className||"")+" decoration-container before-positioning";var a=this.attrs.user,i={username:a.realUserName(),container:o,id:parseInt(a.id()),decorationId:a.attribute("card_decoration")};return this.attrs.decoration_id&&(i.decorationId=this.attrs.decoration_id),c(i,this),o})),(0,k.override)(M().prototype,"view",(function(t,e){for(var r=t(e),n=1;n<r.length;n++){var o,a=r[n],i=a.children[0],c=parseInt((a.attrs["data-index"]||"").substring(5)),u=null==(o=s.getInstance())||null==(o=o.getApp())?void 0:o.store.getById("users",c+"");if(!u)return;var l=q()(u.displayName(),e),d=new x({children:[l],tag:"span",attrs:{className:"username-container",user:this}},u.displayName(),{user:u},"username-text");i.children[1].children=[d]}return r})),flarum.extensions["flarum-mentions"]&&(0,k.override)((null==(t=s.getInstance())?void 0:t.getApp()).mentionFormats.get("@").mentionables.find((function(t){return"u"==t.name})).prototype,"suggestion",(function(t,e,r){var n=t(e,r);if("["!=n.tag)return n;var o=q()(e.displayName(),r),a=new x({children:[o],tag:"span",attrs:{className:"username-container",user:e}},e.displayName(),{user:e},"username-text");return n.children[1].children=[a],n})),_().routes["user.user_own_decoration"]={path:"/u/:username/user_own_decoration",component:Ct},(0,k.extend)(it().prototype,"navItems",(function(t){var e;_().session.user&&t.add("user_own_decoration",ct().component({href:_().route("user.user_own_decoration",{username:null==(e=this.user)?void 0:e.username()}),icon:"fas fa-receipt"},[_().translator.trans("xypp-user-decoration.forum.page.show-decorations")]),10)})),(0,k.extend)(St(),"moderationControls",(function(t,e){var r;null!=(r=_().session.user)&&r.canOfferDecoration()&&t.add("offer-decoration",ht().component({icon:"fas fa-money-bill",onclick:function(){return _().modal.show(Dt,{user_id:e.id()})}},_().translator.trans("xypp-user-decoration.forum.user_controls.offer")))})),"xypp-store"in flarum.extensions&&(r=_(),Bt&&Bt.addFrontendProviders&&Bt.addFrontendProviders("decoration",r.translator.trans("xypp-store.forum.create-modal.providers.decoration"),function(){var t=e(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.store.find("user_decoration_all");case 2:r.store.all("user-decorations").forEach((function(t){e[parseInt(t.id())]="["+r.translator.trans("xypp-user-decoration.forum.decoration-box."+t.attribute("type"))+"]"+t.attribute("name")+":"+t.attribute("desc")}));case 3:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),(function(t){var e=t.itemData();return m("div",{class:"decoration-ShowCase"},Nt(!!r.session.user,m(kt,{decoration_id:e.id,type:e.type,noBtn:!0,noDelete:!0,noEdit:!0}),m(jt(),{text:r.translator.trans("xypp-user-decoration.forum.decoration-box.no-login")})))}),function(){var t=e(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return","");case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()))}));const Lt=flarum.core.compat["common/extenders"];var Ut=r.n(Lt),Ft=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).style=At().attribute("style"),e.type=At().attribute("type"),e.createdAt=At().attribute("createdAt",At().transformDate),e.name=At().attribute("name"),e.desc=At().attribute("desc"),e}return lt(e,t),e}(At()),Tt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).user_id=At().attribute("user_id"),e.decoration_id=At().attribute("decoration_id"),e.decoration_type=At().attribute("type"),e}return lt(e,t),e}(At());const $t=[(new(Ut().Store)).add("user-decorations",Ft),(new(Ut().Store)).add("user-own-decoration",Tt),new(Ut().Model)(j()).attribute("avatar_decoration")]})(),module.exports=n})();
//# sourceMappingURL=forum.js.map